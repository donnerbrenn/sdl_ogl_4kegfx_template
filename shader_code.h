uniform float v[3];float f=v[0],m=v[2]/v[1];mat3 n(vec3 v){float f=cos(v.x),y=sin(v.x),m=cos(v.y),x=sin(v.y),n=cos(v.z),s=sin(v.z);mat3 r=mat3(vec3(1,0,0),vec3(0,f,-y),vec3(0,y,f));r*=mat3(vec3(m,0,x),vec3(0,1,0),vec3(-x,0,m));return r*mat3(vec3(n,-s,0),vec3(s,n,0),vec3(0,0,1));}float n(vec3 v,vec3 f,float x){vec3 m=abs(v)-f;return length(max(m,0.))+min(max(m.x,max(m.y,m.z)),0.)-x;}float n(vec3 v,float m){return v*=m,dot(sin(v+f),cos(v.zxy+f))/m;}float x(float v,float f,float m){float x=max(m-abs(v-f),0.);return min(v,f)-x*x*.25/m;}float x(vec3 v){float m=n(n(vec3(1.5,0.,0.))*v-vec3(0.,0.,1.5),vec3(20,4,.01),.1),r=n(n(vec3(1,f,sin(f*.5)*.5))*v+vec3(0.,.5,0.),vec3(.75/2),.1),y=max(r,n(n(vec3(1,f,sin(f*.5)*.5))*v,20.));r=max(-r,y);return x(m,r,.75);}vec3 s(vec3 v){vec2 m=vec2(.005,0);return normalize(vec3(x(v+m.xyy)-x(v-m.xyy),x(v+m.yxy)-x(v-m.yxy),x(v+m.yyx)-x(v-m.yyx)));}float s(vec3 v,vec3 m,float x){return(dot(v,normalize(m))*.5+.5)*x;}float n(vec3 v,vec3 m,vec3 f,float x){vec3 y=reflect(normalize(m),v);return pow(max(dot(f,y),0),128)*x;}float s(vec3 v,vec3 m){float f=1-abs(length(v-m))/100.;return pow(f,32)*1.5;}float n(in vec3 v,in vec3 m,float f,float r,float y){float n=1.,s=1e+20;for(float i=f;i<r;){float c=x(v+m*i);if(c<.0001)return 0;float z=c*c/(2.*s),l=sqrt(c*c-z*z);n=min(n,y*l/max(0.,i-z));s=c;i+=c;}return n;}void main(){vec2 f=(gl_FragCoord.xy/vec2(v[1],v[2])-.5)/vec2(m,1);vec3 r=vec3(0.,0.,-4.5),y=r,c=normalize(vec3(f,1.));float l=0.;bool z=0;vec3 i;while(y.z<20.){float p=x(y);if(p<.0001){z=true;break;}y+=c*p;}float p=length(r-y);vec3 d=s(y);if(z){l=y*10;vec3 a=vec3(1,.5,-.25),e=vec3(-1,-.5,-.25),t=vec3(-1,.5,.25);float g=s(y,a)*s(d,a,.25)+n(d,a,c,.9),o=s(y,e)*s(d,e,.25)+n(d,e,c,.7),u=s(y,t)*s(d,t,.225)+n(d,t,c,.5);i=vec3(g,o,u)+vec3(.1,.4,.1);vec3 h=r+p*c;i=mix(vec3(0.),i,n(h,normalize(a),.005,length(h-a),20.)*.25+.75);}float a=reflect(r,d);i*=mix(i,vec3(1.,1.,1.),1-exp(-.1*pow(p,128)));i-=p*.05;gl_FragColor=vec4(i,1);}